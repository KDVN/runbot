<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <!--Assets-->
        <template id="runbot.assets" inherit_id="website.assets_frontend">
            <xpath expr="." position="inside">
                <link rel="stylesheet" href="/runbot/static/lib/ionicons/css/ionicons.min.css"/>
                <link rel="stylesheet" href="/runbot/static/src/css/adminlte.min.css"/>
                <link rel="stylesheet" href="/runbot/static/src/css/runbot.css"/>
            </xpath>
        </template>

        <!--Runbot inner layuout-->
        <template id="runbot.layout">
            <t t-call='website.layout'>
                <!-- Content Wrapper. Contains page content -->
                <div class="content-wrapper">
                    <!-- Content Header (Page header) -->
                    <section class="content-header">
                        <ol class="breadcrumb">
                            <li><a href="/runbot"><i class="fa fa-home"></i></a></li>
                            <t t-foreach="breadcrumbs" t-as="breadcrumb">
                                <li t-if="not breadcrumb['active']"><a t-attf-href="#{breadcrumb['url']}"><t t-esc="breadcrumb['string']" /></a></li>
                                <li class="active" t-if="breadcrumb['active']"><t t-esc="breadcrumb['string']" /></li>
                            </t>
                        </ol>
                    </section>
                    <section class="content">
                        <t t-raw="0"/>
                    </section>
                </div>
            </t>
        </template>

        <!--Runbot homepage-->
        <template id="runbot.home" name="Runbot">
            <t t-call='runbot.layout'>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">Repositories</h3>
                                <div class="box-tools">
                                    <div class="input-group input-group-sm" style="width: 150px;">
                                        <input type="text" name="table_search" class="form-control pull-right" placeholder="Search" />

                                        <div class="input-group-btn">
                                            <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body table-responsive no-padding">
                                <table class="table table-hover">
                                    <tbody>
                                        <tr>
                                            <th>Name</th>
                                            <th>Hosted on</th>
                                        </tr>
                                        <t t-foreach="repos" t-as="repo">
                                            <tr>
                                                <td>
                                                   <a t-attf-href="/runbot/#{'repo/%s' % slug(repo)}"><span t-field="repo.name" /></a>
                                                </td>
                                                <td>
                                                    <span t-field="repo.git_host" />
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                </div>
            </t>
        </template>
        <!--Runbot repository page-->
        <template id="runbot.repo" name="Repository">
            <t t-call='runbot.layout'>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">Branches</h3>
                                <div class="box-tools">
                                    <div class="input-group input-group-sm" style="width: 150px;">
                                        <input type="text" name="table_search" class="form-control pull-right" placeholder="Search" />

                                        <div class="input-group-btn">
                                            <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body table-responsive no-padding">
                                <table class="table table-hover">
                                    <tbody>
                                        <tr>
                                            <th style="width:30px"></th>
                                            <th style="width:200px">Name</th>
                                            <th>Builds</th>
                                        </tr>
                                        <t t-foreach="branches" t-as="branch">
                                            <tr>
                                                <td>
                                                   <h4><i t-attf-class="text-center #{'fa fa-star-o text-muted' if not branch.is_sticky else 'fa fa-star text-yellow'}"></i></h4>
                                                </td>
                                                <td>
                                                   <h4 t-field="branch.name" />
                                                </td>
                                                <td>
                                                    <h4 t-if="not branch.build_ids" class="text-muted">There are no builds for this branch yet.</h4>
                                                    <table t-if="branch.build_ids">
                                                        <tr>
                                                            <t t-foreach="branch.build_ids[:5]" t-as="build">
                                                                <td class="builds-wrapper">
                                                                    <div class="info-box">
                                                                        <a t-attf-href="#{'http://localhost:%s' % build.port if build.state == 'running' else '/runbot/build/%s/start' % slug(build)}" t-attf-target="#{'_blank' if build.state == 'running' else '_self'}" t-attf-class="info-box-icon #{'bg-aqua' if build.state == 'running' else 'bg-gray'}">
                                                                            <i t-attf-class="#{'ion-ios-gear-outline' if build.state == 'running' else 'ion-ios-refresh-empty'}"></i>
                                                                        </a>
                                                                        <div class="info-box-content">
                                                                            <a t-attf-href="/runbot/#{'build/%s' % slug(build)}"><span class="info-box-text">#<t t-esc="build.id"/></span></a>
                                                                            <span class="info-box-number" t-field="build.short_name"/>
                                                                        </div>
                                                                        <!-- /.info-box-content -->
                                                                    </div>
                                                                </td>
                                                            </t>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                </div>
            </t>
        </template>
    </data>
</openerp>